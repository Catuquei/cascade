package cascade.features.modules.exploit;

import cascade.Cascade;
import cascade.event.events.PacketEvent;
import cascade.features.modules.Module;
import net.minecraft.network.play.client.CPacketConfirmTeleport;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraftforge.fml.common.eventhandler.EventPriority;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

import java.util.Random;

public class HubTP extends Module {

    public HubTP() {
        super("HubTP", Category.EXPLOIT, "");
    }

    int tpId = 0;

    @Override
    public void onToggle() {
        tpId = 0;
    }

    @Override
    public void onUpdate() {
        if (fullNullCheck() || mc.player.dimension != -1 || mc.player.posY >= 120) {
            disable();
            return;
        }

        mc.getConnection().sendPacket(new CPacketPlayer.Position(mc.player.posX, new Random().nextInt(50) + 127, mc.player.posY, mc.player.onGround));
        mc.getConnection().sendPacket(new CPacketConfirmTeleport(tpId + 1));
        disable();
    }

    @SubscribeEvent(priority = EventPriority.HIGHEST)
    public void onPacketSend(PacketEvent.Send e) {
        if (fullNullCheck() || isDisabled()) {
            return;
        }
        if (e.getPacket() instanceof CPacketPlayer.Position || e.getPacket() instanceof CPacketPlayer.PositionRotation) {
            ((CPacketPlayer) e.getPacket()).y += 0.3;
        }
        if (e.getPacket() instanceof CPacketConfirmTeleport) {
            CPacketConfirmTeleport p = e.getPacket();
            tpId = p.getTeleportId();
        }
    }
}